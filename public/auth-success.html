<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>QR Studio</title>

<style>
/* ===== ORIGINAL CSS ===== */
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
  background:linear-gradient(135deg,#C9FFBF 0%,#FFAFBD 100%);
  min-height:100vh;
}

/* NAVBAR */
.top-bar{
  background:#fff; padding:16px 40px;
  box-shadow:0 2px 8px rgba(0,0,0,.12);
  display:flex; justify-content:space-between; align-items:center;
  position:sticky; top:0; z-index:100;
}
.logo{font-size:24px;font-weight:700;color:#7B1235;cursor:pointer}
.tagline{font-size:12px;color:#6c757d}

/* AVATAR */
.avatar-wrapper{position:relative;cursor:pointer}
.avatar{
  width:38px;height:38px;border-radius:50%;
  background:linear-gradient(135deg,#C9FFBF,#FFAFBD);
  display:flex;align-items:center;justify-content:center;
  font-weight:700;color:#7B1235;border:2px solid #fff;
}
.avatar-dropdown{
  position:absolute;right:0;top:48px;
  background:#fff;border-radius:12px;
  box-shadow:0 10px 30px rgba(0,0,0,.15);
  display:none;min-width:180px;z-index:200
}
.avatar-wrapper.active .avatar-dropdown{display:block}
.avatar-dropdown a{
  display:block;padding:14px 16px;
  text-decoration:none;font-weight:600;color:#343a40
}
.avatar-dropdown a:hover{background:#f8f9fa}

/* LAYOUT */
.main-content{padding:40px 20px;display:flex;justify-content:center}
.container{
  max-width:1200px;width:100%;
  background:#fff;border-radius:24px;
  display:grid;grid-template-columns:1fr 1fr;
  box-shadow:0 20px 60px rgba(255,175,189,.5);
}
.left-panel{padding:48px 40px;border-right:1px solid #ffe0e8}
.right-panel{padding:48px 40px;display:flex;justify-content:center;align-items:center;background:#fffafb}

/* FORM */
.input-group{margin-bottom:22px}
.input-label{display:block;font-weight:600;margin-bottom:6px;color:#495057}
input,select{
  width:100%;padding:14px;border-radius:12px;
  border:2px solid #ffe0e8;font-size:15px;outline:none
}
input:focus,select:focus{border-color:#FF4B72}

/* TOGGLE BUTTONS */
.mode-toggle{display:flex;gap:12px;margin-bottom:20px}
.mode-btn{
  flex:1;padding:12px;border-radius:12px;
  border:2px solid #ffe0e8;background:#fff;
  font-weight:600;cursor:pointer;
  transition:.25s;
}
.mode-btn.active{
  background:linear-gradient(135deg,#C9FFBF,#FFAFBD);
  border-color:transparent;color:#7B1235;
}

button{
  width:100%;padding:16px;border-radius:12px;
  border:none;background:linear-gradient(135deg,#FF80A0,#FF4B72);
  color:white;font-size:16px;font-weight:700;cursor:pointer
}

.preview-placeholder{
  width:360px;height:360px;border:3px dashed #f2709c;
  border-radius:16px;display:flex;align-items:center;
  justify-content:center;color:#adb5bd
}
#qrImg{
  max-width:360px;border-radius:16px;
  box-shadow:0 10px 40px rgba(255,75,114,.2);
}
.download-buttons{display:flex;gap:12px;margin-top:20px;justify-content:center}
.download-buttons button{
  padding:10px 20px;background:#333;color:#fff;border-radius:8px
}
.error{margin-top:12px;color:#dc3545;text-align:center}
</style>
</head>

<body>

<!-- NAVBAR -->
<div class="top-bar">
  <div onclick="window.location.href='dashboard.html'">
    <div class="logo">QR Studio</div>
    <div class="tagline">Create Beautiful QR Codes</div>
  </div>

  <div class="avatar-wrapper" id="avatarMenu">
    <div class="avatar" id="userInitial">U</div>
    <div class="avatar-dropdown">
      <div id="userEmailDisplay"
        style="padding:10px 15px;font-size:12px;color:#888;border-bottom:1px solid #eee"></div>
      <a href="dashboard.html">üìä Dashboard</a>
      <a href="#" id="logoutBtn" style="color:#d63384">üö™ Logout</a>
    </div>
  </div>
</div>

<!-- MAIN -->
<div class="main-content">
<div class="container">

<div class="left-panel">
<form id="qrForm">

<div class="input-group">
  <label class="input-label">QR Name</label>
  <input id="qrTitle" required placeholder="e.g. Instagram Profile">
</div>

<!-- TOGGLE -->
<div class="mode-toggle">
  <button type="button" class="mode-btn active" data-mode="text">üîó Link</button>
  <button type="button" class="mode-btn" data-mode="file">üìÅ File</button>
</div>
<input type="hidden" id="modeInput" value="text">

<div class="input-group" id="textGroup">
  <label class="input-label">Content URL</label>
  <input id="content" placeholder="https://example.com">
</div>

<div class="input-group" id="fileGroup" style="display:none">
  <label class="input-label">Upload File</label>
  <input type="file" id="file">
</div>

<div class="input-group">
  <label class="input-label">Template</label>
  <select id="templateSelect">
    <option value="default">Default</option>
    <option value="business">Business</option>
    <option value="personal">Personal</option>
    <option value="whatsapp">WhatsApp</option>
    <option value="instagram">Instagram</option>
    <option value="linkedin">LinkedIn</option>
    <option value="email">Email</option>
    <option value="wifi">WiFi</option>
    <option value="menu">Restaurant Menu</option>
  </select>
</div>

<div class="input-group">
  <label class="input-label">Size (px)</label>
  <input type="number" id="qrSize" value="400">
</div>

<button type="submit">Generate QR</button>
<div id="error" class="error"></div>

</form>
</div>

<div class="right-panel">
  <div id="preview">
    <div class="preview-placeholder">Preview will appear here</div>
  </div>
</div>

</div>
</div>

<script>
/* AUTH */
const token = localStorage.getItem('qrstudio_token');
const user = JSON.parse(localStorage.getItem('qrstudio_user')||'{}');
if(!token) location.replace('auth.html');

userInitial.textContent = user.name ? user.name[0].toUpperCase() : 'U';
userEmailDisplay.textContent = user.email || '';

avatarMenu.onclick = e => { e.stopPropagation(); avatarMenu.classList.toggle('active'); };
document.onclick = ()=> avatarMenu.classList.remove('active');

logoutBtn.onclick = ()=>{localStorage.clear();location.replace('auth.html')};

/* MODE TOGGLE */
const modeBtns=document.querySelectorAll('.mode-btn');
const modeInput=document.getElementById('modeInput');

modeBtns.forEach(btn=>{
  btn.onclick=()=>{
    modeBtns.forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    modeInput.value=btn.dataset.mode;
    textGroup.style.display=modeInput.value==='text'?'block':'none';
    fileGroup.style.display=modeInput.value==='file'?'block':'none';
  }
});

/* TEMPLATE COLORS */
const templates={
  default:{color:'#000',bg:'#fff',border:4},
  business:{color:'#1a1a1a',bg:'#f0f0f0',border:2},
  personal:{color:'#FF7FA0',bg:'#fff',border:4},
  whatsapp:{color:'#25D366',bg:'#fff',border:3},
  instagram:{color:'#E1306C',bg:'#fff',border:3},
  linkedin:{color:'#0077B5',bg:'#fff',border:3},
  email:{color:'#0066cc',bg:'#f5f5f5',border:4},
  wifi:{color:'#4285F4',bg:'#fff',border:2},
  menu:{color:'#d4af37',bg:'#1a1a1a',border:5}
};

/* SUBMIT */
qrForm.onsubmit=async e=>{
  e.preventDefault();
  error.textContent='';
  preview.innerHTML='<div class="preview-placeholder">Generating...</div>';

  const tpl=templates[templateSelect.value];
  const fd=new FormData();

  fd.append('mode',modeInput.value);
  fd.append('title',qrTitle.value.trim());
  fd.append('size',qrSize.value);
  fd.append('color',tpl.color);
  fd.append('bgcolor',tpl.bg);
  fd.append('border',tpl.border);

  if(modeInput.value==='file'){
    if(!file.files[0]){error.textContent='Upload a file';return;}
    fd.append('file',file.files[0]);
  }else{
    if(!content.value.trim()){error.textContent='Enter URL';return;}
    fd.append('content',content.value.trim());
  }

  try{
    const res=await fetch('/generate',{method:'POST',headers:{Authorization:`Bearer ${token}`},body:fd});
    const data=await res.json();
    if(!res.ok)throw'err';
    preview.innerHTML=`<img id="qrImg" src="${data.pngDataUrl}">
    <div class="download-buttons">
      <a href="${data.pngDataUrl}" download><button>PNG</button></a>
      <a href="${data.pdfDataUrl}" download><button>PDF</button></a>
    </div>`;
  }catch{
    preview.innerHTML='<div class="preview-placeholder">Error</div>';
    error.textContent='QR generation failed';
  }
};
</script>

</body>
</html>
